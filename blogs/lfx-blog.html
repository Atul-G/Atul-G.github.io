<h1 id="linux-kernel-spring-bug-fixing-mentorship-2021">Linux Kernel Spring Bug Fixing Mentorship 2021</h1>
<p>I started my LFX mentorship on bug fixing on March of 2021. It was a 3 month program with work primarily focusing on fixing bugs in the Kernel. The purpose of this blog is to share my experiences and work during this period of mentorsip.</p>
<h2 id="the-application-process">The Application Process</h2>
<p>The application process for the program consisted of a set of tasks to be completed by applicants. The challenges were mainly focused on the various subsystems of the kernel and the final selection of candidates was based on their work on these tasks. The kernel docs were the perfect place for a rich source of information for anything related to the kernel and helped a lot during the application phase.</p>
<h2 id="the-mentorship-phase">The Mentorship phase</h2>
<p>Initial tasks were learning about the various bug fixing paradigms:<br /> - How to read stack traces for kernel OOPS/panic. - Using debugging tools like <code>gdb</code>, <code>objdump</code>, <code>nm</code>. - Running a kernel with <code>CONFIG_KASAN</code> enabled. - Using the script <code>decode_stacktrace.sh</code> for an easier to read call trace. - Learning about Fuzzing and installing and running the syzkaller kernel fuzzer to catch any bugs. - Using <strong>sparse</strong> for static analysis and also playing around with kselftest.</p>
<p>The second phase started with the actual bug fixing work. I kept looking for interesting bugs to investigate. I would often ping my mentor regarding any doubts I stumble upon and would also get help from my friend, a fellow mentee, about various topics I encounter in the kernel. Bugs exist over all sub-systems of the kernel, so reading the docs for a basic understanding of the function APIs of that sub-system was necessary when researching on any bug.</p>
<p>Around late April, there was an incident involving a university where few students and teachers indulged in malicious research and deliberately submitted several buggy patches. The community found out about this and all the commits from the university were reverted. After this, all the reverted patches had to be reviewed and proper fixes needed to be submitted. Our mentor asked us (the mentees) to help in this process and I reviewed 2 and wrote patches for 3 other reverts.</p>
<p>Investigating bugs helped me delve into several areas of the kernel. I started learning about <strong>ebpf</strong> and wrote few programs using <strong>BCC</strong> to trace the return values of a core kernel function while reproducing a bug. There was a small period when there were occurences of several RCU related bugs. As I had no prior knowledge of this, I got help from a friend and read through several articles series in <a href="lwn.net">LWN</a> in order to learn about RCU so that I could understand the bugs.</p>
<h2 id="important-tools">Important Tools</h2>
<p>The important tools that I used for my work, apart from the debugging tools mentioned before: 1. <strong>Virtme</strong> - A very important <a href="https://github.com/amluto/virtme">tool</a> that acts as a wrapper around qemu to allow running new kernel builds without any of the installation process.</p>
<ol start="2" style="list-style-type: decimal">
<li><p><strong>cscope</strong> - to easily spot the definitions of functions.</p></li>
<li><p><strong>Elixir Bootlin</strong> - a <a href="https://elixir.bootlin.com/linux/v5.13-rc3/source">website</a> which allowed browsing the source code in browser. I found this invaluable when I just wanted to follow certain call trace which would go as deep as 10 functions.</p></li>
<li><p><strong>git</strong> - goes without saying just how necessary it is in kernel development. Certain commands like <code>git blame</code> (with extra specific parameters), <code>git worktree</code>, <code>git send-email</code> make life a lot easier. My workflow heavily depended on creating branches for every bug I investigate as each bug is reported first on a certain commit by syzbot, so the call trace would be more accurate to read if we used the same commit.</p></li>
<li><p><strong>Pen and paper</strong> - an under-rated tool. While going through a stack trace, you end up reading code which spans over several files, I would always write down the important variable names/function and it's arguments to draw a map and see how they were related.</p></li>
</ol>
<h2 id="acknowledgements">Acknowledgements</h2>
<p>I would like to thanks my mentors <strong>Greg KH</strong> and <strong>Shuah Khan</strong> for all their help and guidance throughout the mentorship period. Shuah ma'am supported me a lot throughout my doubts and stumbles. I would also like to thank my friend, <strong>Kumar Karthikeya Dwivedi</strong> for helping me out with a lot of C and Kernel concepts and also for his recommendations on several tools like Virtme, ebpf.</p>
